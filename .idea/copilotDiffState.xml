<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/srv/booking-service/src/main/java/com/eventix/booking/controller/BookingController.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/srv/booking-service/src/main/java/com/eventix/booking/controller/BookingController.java" />
              <option name="originalContent" value="package com.eventix.booking.controller;&#10;&#10;import com.eventix.booking.model.Booking;&#10;import com.eventix.booking.service.BookingService;&#10;import io.swagger.v3.oas.annotations.Operation;&#10;import io.swagger.v3.oas.annotations.Parameter;&#10;import io.swagger.v3.oas.annotations.tags.Tag;&#10;import io.swagger.v3.oas.annotations.responses.ApiResponse;&#10;import io.swagger.v3.oas.annotations.responses.ApiResponses;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.http.ResponseEntity;&#10;import org.springframework.http.HttpStatus;&#10;import org.springframework.web.bind.annotation.*;&#10;&#10;import java.net.URI;&#10;import java.util.*;&#10;import java.util.concurrent.CompletableFuture;&#10;&#10;@RestController&#10;@RequestMapping(&quot;/bookings&quot;)&#10;@Tag(name = &quot;Bookings&quot;, description = &quot;Operations related to event bookings&quot;)&#10;public class BookingController {&#10;&#10;    private final BookingService svc;&#10;&#10;    @Autowired&#10;    public BookingController(BookingService svc) {&#10;        this.svc = svc;&#10;    }&#10;&#10;    @Operation(summary = &quot;Create a new booking&quot;, description = &quot;Create a new booking. Use async=true to create in background.&quot;)&#10;    @ApiResponses(value = {&#10;            @ApiResponse(responseCode = &quot;201&quot;, description = &quot;Booking created successfully&quot;),&#10;            @ApiResponse(responseCode = &quot;202&quot;, description = &quot;Booking creation accepted (async)&quot;),&#10;            @ApiResponse(responseCode = &quot;400&quot;, description = &quot;Invalid booking payload&quot;)&#10;    })&#10;    @PostMapping&#10;    public ResponseEntity&lt;?&gt; createBooking(&#10;            @Parameter(description = &quot;Create booking asynchronously if true&quot;, required = false)&#10;            @RequestParam(name = &quot;async&quot;, required = false, defaultValue = &quot;false&quot;) boolean async,&#10;            @Parameter(description = &quot;Booking object to create&quot;, required = true)&#10;            @RequestBody Booking booking) {&#10;&#10;        if (booking == null) {&#10;            return ResponseEntity.badRequest()&#10;                    .body(Map.of(&quot;error&quot;, &quot;Invalid booking payload&quot;));&#10;        }&#10;&#10;        if (async) {&#10;            CompletableFuture&lt;Booking&gt; fut = svc.createBookingAsync(booking);&#10;            String id = booking.getId();&#10;            URI location = URI.create(&quot;/bookings/&quot; + id);&#10;&#10;            return ResponseEntity.accepted()&#10;                    .location(location)&#10;                    .body(Map.of(&#10;                            &quot;id&quot;, id,&#10;                            &quot;status&quot;, &quot;PENDING&quot;,&#10;                            &quot;location&quot;, location.toString()&#10;                    ));&#10;        } else {&#10;            Booking created = svc.createBooking(booking);&#10;            URI location = URI.create(&quot;/bookings/&quot; + created.getId());&#10;            return ResponseEntity.created(location).body(created);&#10;        }&#10;    }&#10;&#10;    @Operation(summary = &quot;Get booking by ID&quot;)&#10;    @ApiResponses(value = {&#10;            @ApiResponse(responseCode = &quot;200&quot;, description = &quot;Booking found&quot;),&#10;            @ApiResponse(responseCode = &quot;404&quot;, description = &quot;Booking not found&quot;)&#10;    })&#10;    @GetMapping(&quot;/{id}&quot;)&#10;    public ResponseEntity&lt;?&gt; getBooking(&#10;            @Parameter(description = &quot;Booking ID to retrieve&quot;, required = true)&#10;            @PathVariable String id) {&#10;        return svc.getBooking(id)&#10;                .&lt;ResponseEntity&lt;?&gt;&gt;map(ResponseEntity::ok)&#10;                .orElseGet(() -&gt;&#10;                        ResponseEntity.status(HttpStatus.NOT_FOUND)&#10;                                .body(Map.of(&quot;error&quot;, &quot;Booking not found&quot;, &quot;id&quot;, id)));&#10;    }&#10;&#10;    @Operation(summary = &quot;List all bookings or filter by userId&quot;)&#10;    @GetMapping&#10;    public ResponseEntity&lt;List&lt;Booking&gt;&gt; listBookings(&#10;            @Parameter(description = &quot;Filter bookings by userId&quot;, required = false)&#10;            @RequestParam(name = &quot;userId&quot;, required = false) String userId) {&#10;        List&lt;Booking&gt; results = (userId != null &amp;&amp; !userId.isBlank())&#10;                ? svc.getBookingsByUser(userId)&#10;                : svc.getAllBookings();&#10;        return ResponseEntity.ok(results);&#10;    }&#10;&#10;    @Operation(summary = &quot;Get bookings by event IDs&quot;, description = &quot;Fetch bookings for one or more event IDs&quot;)&#10;    @ApiResponses(value = {&#10;            @ApiResponse(responseCode = &quot;200&quot;, description = &quot;Bookings retrieved successfully&quot;),&#10;            @ApiResponse(responseCode = &quot;400&quot;, description = &quot;Invalid request parameters&quot;)&#10;    })&#10;    @GetMapping(&quot;/by-events&quot;)&#10;    public ResponseEntity&lt;?&gt; getBookingsByEventIds(&#10;            @Parameter(description = &quot;Single event ID to filter bookings&quot;, required = false)&#10;            @RequestParam(name = &quot;eventId&quot;, required = false) String eventId,&#10;            @Parameter(description = &quot;Multiple event IDs to filter bookings (comma-separated)&quot;, required = false)&#10;            @RequestParam(name = &quot;eventIds&quot;, required = false) List&lt;String&gt; eventIds) {&#10;        &#10;        if (eventId != null &amp;&amp; !eventId.isBlank()) {&#10;            List&lt;Booking&gt; results = svc.getBookingsByEventId(eventId);&#10;            return ResponseEntity.ok(results);&#10;        } else if (eventIds != null &amp;&amp; !eventIds.isEmpty()) {&#10;            List&lt;Booking&gt; results = svc.getBookingsByEventIds(eventIds);&#10;            return ResponseEntity.ok(results);&#10;        } else {&#10;            return ResponseEntity.badRequest()&#10;                    .body(Map.of(&quot;error&quot;, &quot;Either eventId or eventIds parameter is required&quot;));&#10;        }&#10;    }&#10;&#10;    @Operation(summary = &quot;Get booking statistics&quot;)&#10;    @GetMapping(&quot;/stats&quot;)&#10;    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; getStats() {&#10;        return ResponseEntity.ok(svc.stats());&#10;    }&#10;&#10;    @Operation(summary = &quot;Get trending bookings&quot;, description = &quot;Returns the most trending bookings&quot;)&#10;    @GetMapping(&quot;/trending&quot;)&#10;    public ResponseEntity&lt;List&lt;Booking&gt;&gt; getTrending(&#10;            @Parameter(description = &quot;Maximum number of trending bookings&quot;, required = false)&#10;            @RequestParam(name = &quot;limit&quot;, defaultValue = &quot;5&quot;) int limit) {&#10;        return ResponseEntity.ok(svc.trending(limit));&#10;    }&#10;&#10;    @Operation(summary = &quot;Get personalized bookings for a user&quot;)&#10;    @GetMapping(&quot;/personalized&quot;)&#10;    public ResponseEntity&lt;List&lt;Booking&gt;&gt; getPersonalized(&#10;            @Parameter(description = &quot;User ID for personalized results&quot;, required = false)&#10;            @RequestParam(name = &quot;userId&quot;, required = false) String userId,&#10;            @Parameter(description = &quot;Limit number of results&quot;, required = false)&#10;            @RequestParam(name = &quot;limit&quot;, defaultValue = &quot;5&quot;) int limit) {&#10;        return ResponseEntity.ok(svc.personalized(userId, limit));&#10;    }&#10;&#10;    @Operation(summary = &quot;Delete booking by ID&quot;)&#10;    @ApiResponses(value = {&#10;            @ApiResponse(responseCode = &quot;204&quot;, description = &quot;Booking deleted successfully&quot;),&#10;            @ApiResponse(responseCode = &quot;404&quot;, description = &quot;Booking not found&quot;),&#10;            @ApiResponse(responseCode = &quot;500&quot;, description = &quot;Failed to delete booking&quot;)&#10;    })&#10;    @DeleteMapping(&quot;/{id}&quot;)&#10;    public ResponseEntity&lt;?&gt; deleteBooking(&#10;            @Parameter(description = &quot;Booking ID to delete&quot;, required = true)&#10;            @PathVariable String id) {&#10;        try {&#10;            svc.deleteBooking(id);&#10;            return ResponseEntity.noContent().build();&#10;        } catch (NoSuchElementException e) {&#10;            return ResponseEntity.status(HttpStatus.NOT_FOUND)&#10;                    .body(Map.of(&quot;error&quot;, &quot;Booking not found&quot;, &quot;id&quot;, id));&#10;        } catch (Exception e) {&#10;            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)&#10;                    .body(Map.of(&quot;error&quot;, &quot;Failed to delete booking&quot;, &quot;details&quot;, e.getMessage()));&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.eventix.booking.controller;&#10;&#10;import com.eventix.booking.model.Booking;&#10;import com.eventix.booking.service.BookingService;&#10;import io.swagger.v3.oas.annotations.Operation;&#10;import io.swagger.v3.oas.annotations.Parameter;&#10;import io.swagger.v3.oas.annotations.tags.Tag;&#10;import io.swagger.v3.oas.annotations.responses.ApiResponse;&#10;import io.swagger.v3.oas.annotations.responses.ApiResponses;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.http.ResponseEntity;&#10;import org.springframework.http.HttpStatus;&#10;import org.springframework.web.bind.annotation.*;&#10;&#10;import java.net.URI;&#10;import java.util.*;&#10;import java.util.concurrent.CompletableFuture;&#10;&#10;@RestController&#10;@RequestMapping(&quot;/bookings&quot;)&#10;@Tag(name = &quot;Bookings&quot;, description = &quot;Operations related to event bookings&quot;)&#10;public class BookingController {&#10;&#10;    private final BookingService svc;&#10;&#10;    @Autowired&#10;    public BookingController(BookingService svc) {&#10;        this.svc = svc;&#10;    }&#10;&#10;    @Operation(summary = &quot;Create a new booking&quot;, description = &quot;Create a new booking. Use async=true to create in background.&quot;)&#10;    @ApiResponses(value = {&#10;            @ApiResponse(responseCode = &quot;201&quot;, description = &quot;Booking created successfully&quot;),&#10;            @ApiResponse(responseCode = &quot;202&quot;, description = &quot;Booking creation accepted (async)&quot;),&#10;            @ApiResponse(responseCode = &quot;400&quot;, description = &quot;Invalid booking payload&quot;)&#10;    })&#10;    @PostMapping&#10;    public ResponseEntity&lt;?&gt; createBooking(&#10;            @Parameter(description = &quot;Create booking asynchronously if true&quot;, required = false)&#10;            @RequestParam(name = &quot;async&quot;, required = false, defaultValue = &quot;false&quot;) boolean async,&#10;            @Parameter(description = &quot;Booking object to create&quot;, required = true)&#10;            @RequestBody Booking booking) {&#10;&#10;        if (booking == null) {&#10;            return ResponseEntity.badRequest()&#10;                    .body(Map.of(&quot;error&quot;, &quot;Invalid booking payload&quot;));&#10;        }&#10;&#10;        if (async) {&#10;            CompletableFuture&lt;Booking&gt; fut = svc.createBookingAsync(booking);&#10;            String id = booking.getId();&#10;            URI location = URI.create(&quot;/bookings/&quot; + id);&#10;&#10;            return ResponseEntity.accepted()&#10;                    .location(location)&#10;                    .body(Map.of(&#10;                            &quot;id&quot;, id,&#10;                            &quot;status&quot;, &quot;PENDING&quot;,&#10;                            &quot;location&quot;, location.toString()&#10;                    ));&#10;        } else {&#10;            Booking created = svc.createBooking(booking);&#10;            URI location = URI.create(&quot;/bookings/&quot; + created.getId());&#10;            return ResponseEntity.created(location).body(created);&#10;        }&#10;    }&#10;&#10;    @Operation(summary = &quot;Get booking by ID&quot;)&#10;    @ApiResponses(value = {&#10;            @ApiResponse(responseCode = &quot;200&quot;, description = &quot;Booking found&quot;),&#10;            @ApiResponse(responseCode = &quot;404&quot;, description = &quot;Booking not found&quot;)&#10;    })&#10;    @GetMapping(&quot;/{id}&quot;)&#10;    public ResponseEntity&lt;?&gt; getBooking(&#10;            @Parameter(description = &quot;Booking ID to retrieve&quot;, required = true)&#10;            @PathVariable String id) {&#10;        return svc.getBooking(id)&#10;                .&lt;ResponseEntity&lt;?&gt;&gt;map(ResponseEntity::ok)&#10;                .orElseGet(() -&gt;&#10;                        ResponseEntity.status(HttpStatus.NOT_FOUND)&#10;                                .body(Map.of(&quot;error&quot;, &quot;Booking not found&quot;, &quot;id&quot;, id)));&#10;    }&#10;&#10;    @Operation(summary = &quot;List all bookings or filter by userId&quot;)&#10;    @GetMapping&#10;    public ResponseEntity&lt;List&lt;Booking&gt;&gt; listBookings(&#10;            @Parameter(description = &quot;Filter bookings by userId&quot;, required = false)&#10;            @RequestParam(name = &quot;userId&quot;, required = false) String userId) {&#10;        List&lt;Booking&gt; results = (userId != null &amp;&amp; !userId.isBlank())&#10;                ? svc.getBookingsByUser(userId)&#10;                : svc.getAllBookings();&#10;        return ResponseEntity.ok(results);&#10;    }&#10;&#10;    @Operation(summary = &quot;Get bookings by event IDs&quot;, description = &quot;Fetch bookings for one or more event IDs&quot;)&#10;    @ApiResponses(value = {&#10;            @ApiResponse(responseCode = &quot;200&quot;, description = &quot;Bookings retrieved successfully&quot;),&#10;            @ApiResponse(responseCode = &quot;400&quot;, description = &quot;Invalid request parameters&quot;)&#10;    })&#10;    @GetMapping(&quot;/by-events&quot;)&#10;    public ResponseEntity&lt;?&gt; getBookingsByEventIds(&#10;            @Parameter(description = &quot;Single event ID to filter bookings&quot;, required = false)&#10;            @RequestParam(name = &quot;eventId&quot;, required = false) String eventId,&#10;            @Parameter(description = &quot;Multiple event IDs to filter bookings (comma-separated)&quot;, required = false)&#10;            @RequestParam(name = &quot;eventIds&quot;, required = false) List&lt;String&gt; eventIds) {&#10;        &#10;        if (eventId != null &amp;&amp; !eventId.isBlank()) {&#10;            List&lt;Booking&gt; results = svc.getBookingsByEventId(eventId);&#10;            return ResponseEntity.ok(results);&#10;        } else if (eventIds != null &amp;&amp; !eventIds.isEmpty()) {&#10;            List&lt;Booking&gt; results = svc.getBookingsByEventIds(eventIds);&#10;            return ResponseEntity.ok(results);&#10;        } else {&#10;            return ResponseEntity.badRequest()&#10;                    .body(Map.of(&quot;error&quot;, &quot;Either eventId or eventIds parameter is required&quot;));&#10;        }&#10;    }&#10;&#10;    @Operation(summary = &quot;Get booking statistics&quot;)&#10;    @GetMapping(&quot;/stats&quot;)&#10;    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; getStats() {&#10;        return ResponseEntity.ok(svc.stats());&#10;    }&#10;&#10;    @Operation(summary = &quot;Get trending bookings&quot;, description = &quot;Returns the most trending bookings&quot;)&#10;    @GetMapping(&quot;/trending&quot;)&#10;    public ResponseEntity&lt;List&lt;Booking&gt;&gt; getTrending(&#10;            @Parameter(description = &quot;Maximum number of trending bookings&quot;, required = false)&#10;            @RequestParam(name = &quot;limit&quot;, defaultValue = &quot;5&quot;) int limit) {&#10;        return ResponseEntity.ok(svc.trending(limit));&#10;    }&#10;&#10;    @Operation(summary = &quot;Get personalized bookings for a user&quot;)&#10;    @GetMapping(&quot;/personalized&quot;)&#10;    public ResponseEntity&lt;List&lt;Booking&gt;&gt; getPersonalized(&#10;            @Parameter(description = &quot;User ID for personalized results&quot;, required = false)&#10;            @RequestParam(name = &quot;userId&quot;, required = false) String userId,&#10;            @Parameter(description = &quot;Limit number of results&quot;, required = false)&#10;            @RequestParam(name = &quot;limit&quot;, defaultValue = &quot;5&quot;) int limit) {&#10;        return ResponseEntity.ok(svc.personalized(userId, limit));&#10;    }&#10;&#10;    @Operation(summary = &quot;Delete booking by ID&quot;)&#10;    @ApiResponses(value = {&#10;            @ApiResponse(responseCode = &quot;204&quot;, description = &quot;Booking deleted successfully&quot;),&#10;            @ApiResponse(responseCode = &quot;404&quot;, description = &quot;Booking not found&quot;),&#10;            @ApiResponse(responseCode = &quot;500&quot;, description = &quot;Failed to delete booking&quot;)&#10;    })&#10;    @DeleteMapping(&quot;/{id}&quot;)&#10;    public ResponseEntity&lt;?&gt; deleteBooking(&#10;            @Parameter(description = &quot;Booking ID to delete&quot;, required = true)&#10;            @PathVariable String id) {&#10;        try {&#10;            svc.deleteBooking(id);&#10;            return ResponseEntity.noContent().build();&#10;        } catch (NoSuchElementException e) {&#10;            return ResponseEntity.status(HttpStatus.NOT_FOUND)&#10;                    .body(Map.of(&quot;error&quot;, &quot;Booking not found&quot;, &quot;id&quot;, id));&#10;        } catch (Exception e) {&#10;            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)&#10;                    .body(Map.of(&quot;error&quot;, &quot;Failed to delete booking&quot;, &quot;details&quot;, e.getMessage()));&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>